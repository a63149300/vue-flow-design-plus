webpackJsonp([1],{"/986":function(t,e){},"2gX3":function(t,e){},"3Ij7":function(t,e){},"3QEs":function(t,e){},"58Rz":function(t,e){},"7sfx":function(t,e){},"8G3d":function(t,e){},"8cGr":function(t,e){},B9tX:function(t,e){},C6QW:function(t,e){},DZT6:function(t,e){},GB6M:function(t,e){},IJNH:function(t,e){},MjqY:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("7+uW"),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var a=n("VU/8")({name:"App"},i,!1,function(t){n("iBfo")},"data-v-cc987130",null).exports,l=(n("v44q"),n("7QS3")),r=(n("wJ7a"),n("nOmy")),s=(n("jPjZ"),n("QzVA")),c=(n("mbIX"),n("jPt1")),u=(n("f/FA"),n("+B68")),d=(n("yiKg"),n("syu6")),f=(n("q3EG"),n("0VVK")),p=(n("nYLA"),n("bfLU")),h=(n("QQuP"),n("J65+")),m=(n("NUbX"),n("mONx")),g=(n("D5Mw"),n("IlMV")),v=(n("E5qJ"),n("XjQx")),y=(n("OWWv"),n("Jyaz")),w=(n("btEx"),n("7sBf")),b=(n("fHJy"),n("4nqm")),C=(n("OYt5"),n("N9Cs")),x=(n("Xvzw"),n("BEsa")),S=(n("CkVG"),n("0GVE")),k=(n("GWFU"),n("JVia")),L=(n("W6yf"),n("xtas")),N=(n("gurA"),n("+kBM"));o.default.use(N.a),o.default.use(L.a),o.default.use(k.a),o.default.use(S.a),o.default.use(x.a),o.default.use(C.a),o.default.use(b.a),o.default.use(w.a),o.default.use(y.a),o.default.use(v.b),o.default.use(g.a),o.default.use(m.a),o.default.use(h.a),o.default.use(p.b),o.default.use(f.a),o.default.use(d.a),o.default.use(u.a),o.default.use(c.a),o.default.use(s.a),o.default.use(r.a),o.default.prototype.$message=l.a;n("hZ/y");var D=n("/ocq"),_=n("mvHQ"),I=n.n(_),T=n("woOf"),M=n.n(T),P=n("3eaK"),G=n("kvU2"),F=n.n(G),A=[{type:"drag",icon:"drag",name:"拖拽"},{type:"connection",icon:"fork",name:"连线"}],E=[{type:"start",nodeName:"开始",icon:"play-circle"},{type:"common",nodeName:"人工节点",icon:"user"},{type:"freedom",nodeName:"自动节点",icon:"sync"},{type:"gateway",nodeName:"网关",icon:"gateway"},{type:"event",nodeName:"事件",icon:"select"},{type:"end",nodeName:"结束",icon:"stop"}],$=[{type:"child-flow",nodeName:"子流程",icon:"apartment"}],O=[{type:"x-lane",nodeName:"横向泳道",icon:"column-width"},{type:"y-lane",nodeName:"纵向泳道",icon:"column-height"}],z={containerScale:{onceNarrow:.1,onceEnlarge:.1},cls:{linkType:"Flowchart",linkColor:"#2a2929",linkThickness:2},other:{isOpenAuxiliaryLine:!0,horizontal:100,vertical:100,movePx:5}},q={jsPlumbInsConfig:{Connector:[z.cls.linkType,{gap:5,cornerRadius:8,alwaysRespectStubs:!0}],ConnectionOverlays:[["Arrow",{width:10,length:10,location:1}]],PaintStyle:{stroke:z.cls.linkColor,strokeWidth:z.cls.linkThickness},HoverPaintStyle:{stroke:"#409EFF",strokeWidth:3},EndpointStyle:{fill:"#456",stroke:"#2a2929",strokeWidth:1,radius:3},EndpointHoverStyle:{fill:"pink"}},jsPlumbConfig:{anchor:{default:["Bottom","Right","Top","Left"]},conn:{isDetachable:!1},makeSourceConfig:{filter:"a",filterExclude:!0,maxConnections:-1,endpoint:["Dot",{radius:7}],anchor:["Bottom","Right","Top","Left"]},makeTargetConfig:{filter:"a",filterExclude:!0,maxConnections:-1,endpoint:["Dot",{radius:7}],anchor:["Bottom","Right","Top","Left"]}},defaultStyle:{dragOpacity:.7,alignGridPX:[5,5],alignSpacing:{horizontal:z.other.horizontal,vertical:z.other.vertical},alignDuration:300,containerScale:{init:1,min:.5,max:3,onceNarrow:z.containerScale.onceNarrow,onceEnlarge:z.containerScale.onceEnlarge},isOpenAuxiliaryLine:z.other.isOpenAuxiliaryLine,showAuxiliaryLineDistance:20,movePx:z.other.movePx,photoBlankDistance:200}},H="0",V="1",R="2",j="3",U={multiple:{code:16,codeName:"SHIFT",shortcutName:"多选"},dragContainer:{code:32,codeName:"SPACE",shortcutName:"画布拖拽"},dragTool:{code:68,codeName:"D",shortcutName:"拖拽工具"},connTool:{code:76,codeName:"L",shortcutName:"连线工具"},leftMove:{code:37,codeName:"←",shortcutName:"左移"},upMove:{code:38,codeName:"↑",shortcutName:"上移"},rightMove:{code:39,codeName:"→",shortcutName:"右移"},downMove:{code:40,codeName:"↓",shortcutName:"下移"},settingModal:{code:83,codeName:"CTRL + S",shortcutName:"保存页面"},testModal:{code:84,codeName:"CTRL + T",shortcutName:"测试页面"}},X={menuName:"flow-menu",axis:{x:null,y:null},menulists:[{fnHandler:"flowInfo",icoName:"edit",btnName:"流程图信息"},{fnHandler:"paste",icoName:"edit",btnName:"粘贴"},{fnHandler:"selectAll",icoName:"edit",btnName:"全选"},{fnHandler:"saveFlow",icoName:"edit",btnName:"保存流程"},{iconName:"edit",fnHandler:"addRemark",btnName:"添加备注"},{icoName:"edit",btnName:"对齐方式",children:[{icoName:"edit",fnHandler:"verticaLeft",btnName:"垂直左对齐"},{icoName:"edit",fnHandler:"verticalCenter",btnName:"垂直居中"},{icoName:"edit",fnHandler:"verticalRight",btnName:"垂直右对齐"},{icoName:"edit",fnHandler:"levelUp",btnName:"水平上对齐"},{icoName:"edit",fnHandler:"levelCenter",btnName:"水平居中"},{icoName:"edit",fnHandler:"levelDown",btnName:"水平下对齐"}]}]},J={menuName:"node-menu",axis:{x:null,y:null},menulists:[{fnHandler:"copyNode",icoName:"edit",btnName:"复制节点"},{fnHandler:"deleteNode",icoName:"edit",btnName:"删除节点"}]},Y={menuName:"link-menu",axis:{x:null,y:null},menulists:[{fnHandler:"deleteLink",icoName:"edit",btnName:"删除连线"}]},B=n("eMjc"),W=n.n(B),Z=n("y7fq"),K=n.n(Z),Q={seqNo:1,consoleLog:function(t){for(var e="",n=0,o=t.length;n<o;n++)e+=t[n]+"\n";console.log("%c"+e,"color: red; font-weight: bold;")},getId:function(){var t="uuid";if("string"==typeof t){if("uuid"===t)return this.getUUID();if("time_stamp"===t)return this.getTimeStamp()}else if(t instanceof Array){if("sequence"===t[0])return this.getSequence(t[1]);if("time_stamp_and_sequence"===t[0])return this.getTimeStampAndSequence(t[1]);if("custom"===t[0])return t[1]()}},getUUID:function(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("").replace(/-/g,"")},getTimeStamp:function(){return(new Date).getTime()},getSequence:function(t){return(new Array(t).fill("0").join("")+this.seqNo++).slice(-t)},getTimeStampAndSequence:function(t){return this.getTimeStamp()+this.getSequence(t)},add:function(t,e){var n,o=void 0,i=void 0;try{o=t.toString().split(".")[1].length}catch(t){o=0}try{i=e.toString().split(".")[1].length}catch(t){i=0}return n=Math.pow(10,Math.max(o,i)),(this.mul(t,n)+this.mul(e,n))/n},sub:function(t,e){var n,o=void 0,i=void 0;try{o=t.toString().split(".")[1].length}catch(t){o=0}try{i=e.toString().split(".")[1].length}catch(t){i=0}return n=Math.pow(10,Math.max(o,i)),(this.mul(t,n)-this.mul(e,n))/n},mul:function(t,e){var n=0,o=t.toString(),i=e.toString();try{n+=o.split(".")[1].length}catch(t){}try{n+=i.split(".")[1].length}catch(t){}return Number(o.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,n)},div:function(t,e){var n,o,i=0,a=0;try{i=t.toString().split(".")[1].length}catch(t){}try{a=e.toString().split(".")[1].length}catch(t){}return n=Number(t.toString().replace(".","")),o=Number(e.toString().replace(".","")),this.mul(n/o,Math.pow(10,a-i))}};function tt(t,e){return t.defaultStyle.containerScale.onceNarrow=e.containerScale.onceNarrow,t.defaultStyle.containerScale.onceEnlarge=e.containerScale.onceEnlarge,t.jsPlumbInsConfig.Connector[0]=e.cls.linkType,t.jsPlumbInsConfig.PaintStyle.stroke=e.cls.linkColor,t.jsPlumbInsConfig.PaintStyle.strokeWidth=e.cls.linkThickness,t.defaultStyle.isOpenAuxiliaryLine=e.other.isOpenAuxiliaryLine,t.defaultStyle.alignSpacing.horizontal=e.other.horizontal,t.defaultStyle.alignSpacing.vertical=e.other.vertical,t.defaultStyle.movePx=e.other.movePx,t}var et=n("sq0L"),nt={props:["select","selectGroup","node","plumb","currentTool","flowConfig"],mounted:function(){this.registerNode()},data:function(){return{currentSelect:this.select,currentSelectGroup:this.selectGroup}},methods:{setIcon:function(t){switch(t){case"common":return"user";case"freedom":return"sync";case"child-flow":return"apartment";default:return"tool"}},setCursor:function(t){switch(t){case"drag":return"move";case"connection":return"crosshair";default:return"default"}},registerNode:function(){var t=this;if(this.plumb.draggable(this.node.id,{containment:"parent",handle:function(t,e){for(var n=e.parentNode.querySelectorAll(".common-circle-node,.common-rectangle-node,.common-diamond-node,.lane-text-div"),o=0;o<n.length;o++)if(n[o]===e||"lane-text"===t.target.className)return!0;return!1},grid:this.flowConfig.defaultStyle.alignGridPX,drag:function(e){t.flowConfig.defaultStyle.isOpenAuxiliaryLine&&t.$emit("alignForLine",e)},stop:function(e){t.node.x=e.pos[0],t.node.y=e.pos[1],t.currentSelectGroup.length>1&&t.$emit("updateNodePos"),t.$emit("hideAlignLine")}}),"x-lane"===this.node.type||"y-lane"===this.node.type){var e=document.querySelector("#"+this.node.id);new et.a(e,{handles:["e","w","n","s","nw","ne","sw","se"],initSize:{maxWidth:1e3,maxHeight:1e3,minWidth:200,minHeight:200}},function(){t.node.height=Math.ceil(parseInt(e.style.height)),t.node.width=Math.ceil(parseInt(e.style.width))})}this.currentSelect=this.node,this.currentSelectGroup=[]},selectNode:function(){var t=this;this.currentSelect=this.node,this.$emit("isMultiple",function(e){e?t.currentSelectGroup.find(function(e){return e.id===t.node.id})||(t.plumb.addToDragSelection(t.node.id),t.currentSelectGroup.push(t.node)):t.currentSelectGroup=[]})},showNodeContextMenu:function(t){this.$emit("showNodeContextMenu",t),this.selectNode()},isActive:function(){var t=this;return this.currentSelect.id===this.node.id||!!this.currentSelectGroup.find(function(e){return e.id===t.node.id})}},watch:{select:function(t){this.currentSelect=t},currentSelect:{handler:function(t){this.$emit("update:select",t)},deep:!0},selectGroup:function(t){this.currentSelectGroup=t},currentSelectGroup:{handler:function(t){this.$emit("update:selectGroup",t)},deep:!0}}},ot={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return"start"===t.node.type||"end"===t.node.type||"event"===t.node.type?n("div",{staticClass:"common-circle-node",class:{active:t.isActive(),isStart:"start"===t.node.type,isEnd:"end"===t.node.type},style:{top:t.node.y+"px",left:t.node.x+"px",cursor:t.setCursor(t.currentTool.type)},attrs:{id:t.node.id},on:{click:function(e){return e.stopPropagation(),t.selectNode.apply(null,arguments)},contextmenu:function(e){return e.stopPropagation(),t.showNodeContextMenu.apply(null,arguments)}}},[t._v("\n  "+t._s(t.node.nodeName)+"\n")]):"common"===t.node.type||"freedom"===t.node.type||"child-flow"===t.node.type?n("div",{staticClass:"common-rectangle-node",class:{active:t.isActive()},style:{top:t.node.y+"px",left:t.node.x+"px",cursor:t.setCursor(t.currentTool.type)},attrs:{id:t.node.id},on:{click:function(e){return e.stopPropagation(),t.selectNode.apply(null,arguments)},contextmenu:function(e){return e.stopPropagation(),t.showNodeContextMenu.apply(null,arguments)}}},[n("a-icon",{staticClass:"node-icon",attrs:{type:t.setIcon(t.node.type)}}),t._v("\n  "+t._s(t.node.nodeName)+"\n")],1):"gateway"===t.node.type?n("div",{staticClass:"common-diamond-node",class:{active:t.isActive()},style:{top:t.node.y+"px",left:t.node.x+"px",cursor:t.setCursor(t.currentTool.type)},attrs:{id:t.node.id},on:{click:function(e){return e.stopPropagation(),t.selectNode.apply(null,arguments)},contextmenu:function(e){return e.stopPropagation(),t.showNodeContextMenu.apply(null,arguments)}}}):"x-lane"===t.node.type?n("div",{staticClass:"common-x-lane-node",class:{active:t.isActive()},style:{top:t.node.y+"px",left:t.node.x+"px",height:t.node.height+"px",width:t.node.width+"px"},attrs:{id:t.node.id}},[n("div",{staticClass:"lane-text-div",style:{cursor:t.setCursor(t.currentTool.type)},on:{click:function(e){return e.stopPropagation(),t.selectNode.apply(null,arguments)},contextmenu:function(e){return e.stopPropagation(),t.showNodeContextMenu.apply(null,arguments)}}},[n("span",{staticClass:"lane-text"},[t._v(t._s(t.node.nodeName))])])]):"y-lane"===t.node.type?n("div",{staticClass:"common-y-lane-node",class:{active:t.isActive()},style:{top:t.node.y+"px",left:t.node.x+"px",height:t.node.height+"px",width:t.node.width+"px"},attrs:{id:t.node.id}},[n("div",{staticClass:"lane-text-div",style:{cursor:t.setCursor(t.currentTool.type)},on:{click:function(e){return e.stopPropagation(),t.selectNode.apply(null,arguments)},contextmenu:function(e){return e.stopPropagation(),t.showNodeContextMenu.apply(null,arguments)}}},[n("span",{staticClass:"lane-text"},[t._v(t._s(t.node.nodeName))])])]):n("div")},staticRenderFns:[]};var it={props:["browserType","flowData","plumb","select","selectGroup","currentTool","dragInfo","flowConfig"],components:{FlowNode:n("VU/8")(nt,ot,!1,function(t){n("DZT6")},null,null).exports},data:function(){return{currentSelect:this.select,currentSelectGroup:this.selectGroup,container:{pos:{top:-4e3,left:-4e3},dragFlag:!1,draging:!1,scale:this.flowConfig.defaultStyle.containerScale.init,scaleFlag:!1,scaleOrigin:{x:0,y:0},scaleShow:Q.mul(this.flowConfig.defaultStyle.containerScale.init,100),auxiliaryLine:{isOpen:this.flowConfig.defaultStyle.isOpenAuxiliaryLine,isShowXLine:!1,isShowYLine:!1,controlFnTimesFlag:!0}},auxiliaryLinePos:{x:0,y:0},mouse:{position:{x:0,y:0},tempPos:{x:0,y:0}},rectangleMultiple:{flag:!1,multipling:!1,position:{top:0,left:0},height:0,width:0},containerContextMenuData:X,nodeContextMenuData:J,tempLinkId:"",clipboard:[]}},computed:{gridStyle:function(){return{top:this.container.pos.top+"px",left:this.container.pos.left+"px",transform:"scale("+this.container.scale+")",transformOrigin:this.container.scaleOrigin.x+"px "+this.container.scaleOrigin.y+"px"}}},methods:{allowDrop:function(t){t.preventDefault(),this.mousemoveHandler(t)},drop:function(){var t=this,e=this.dragInfo.belongTo,n=this.dragInfo.type;this.$emit("selectTool","drag"),this.$emit("findNodeConfig",e,n,function(e){e?t.addNewNode(e):t.$message.error("未知的节点类型！")})},mousedownHandler:function(t){0===(window.event||t).button&&(this.container.dragFlag&&(this.mouse.tempPos=this.mouse.position,this.container.draging=!0),this.currentSelectGroup=[],this.rectangleMultiple.flag&&(this.mouse.tempPos=this.mouse.position,this.rectangleMultiple.multipling=!0))},mousemoveHandler:function(t){var e=window.event||t;if("flowContainer"===e.target.id)this.mouse.position={x:e.offsetX,y:e.offsetY};else{var n=e.target.className,o=e.target.tagName;"lane-text"!==n&&"lane-text-div"!==n&&"svg"!==o&&"path"!==o&&"I"!==o&&(this.mouse.position.x=e.target.offsetLeft+e.offsetX,this.mouse.position.y=e.target.offsetTop+e.offsetY)}if(this.container.draging){var i=this.container.pos.top+(this.mouse.position.y-this.mouse.tempPos.y),a=this.container.pos.left+(this.mouse.position.x-this.mouse.tempPos.x);i>=0&&(i=0),a>=0&&(a=0),this.container.pos={top:i,left:a}}if(this.rectangleMultiple.multipling){var l=this.mouse.position.y-this.mouse.tempPos.y,r=this.mouse.position.x-this.mouse.tempPos.x,s=this.mouse.tempPos.y,c=this.mouse.tempPos.x;l>=0&&r<0?c-=r=-r:l<0&&r>=0?s-=l=-l:l<0&&r<0&&(s-=l=-l,c-=r=-r),this.rectangleMultiple.height=l,this.rectangleMultiple.width=r,this.rectangleMultiple.position.top=s,this.rectangleMultiple.position.left=c}},mouseupHandler:function(){this.container.draging&&(this.container.draging=!1),this.rectangleMultiple.multipling&&(this.judgeSelectedNode(),this.rectangleMultiple.multipling=!1,this.rectangleMultiple.width=0,this.rectangleMultiple.height=0)},judgeSelectedNode:function(){var t=this,e=this.rectangleMultiple.position.top,n=this.rectangleMultiple.position.left,o=e+this.rectangleMultiple.height,i=n+this.rectangleMultiple.width;this.flowData.nodeList.forEach(function(a){a.y>=e&&a.x>=n&&a.y<=o&&a.x<=i&&(t.plumb.addToDragSelection(a.id),t.currentSelectGroup.push(a))})},scaleContainer:function(t){var e=window.event||t;this.container.scaleFlag&&(2===this.browserType?e.detail<0?this.enlargeContainer():this.narrowContainer():e.deltaY<0?this.enlargeContainer():this.container.scale&&this.narrowContainer())},enlargeContainer:function(){this.container.scaleOrigin.x=this.mouse.position.x,this.container.scaleOrigin.y=this.mouse.position.y;var t=Q.add(this.container.scale,this.flowConfig.defaultStyle.containerScale.onceEnlarge);t<=this.flowConfig.defaultStyle.containerScale.max&&(this.container.scale=t,this.container.scaleShow=Q.mul(this.container.scale,100),this.plumb.setZoom(this.container.scale))},narrowContainer:function(){this.container.scaleOrigin.x=this.mouse.position.x,this.container.scaleOrigin.y=this.mouse.position.y;var t=Q.sub(this.container.scale,this.flowConfig.defaultStyle.containerScale.onceNarrow);t>=this.flowConfig.defaultStyle.containerScale.min&&(this.container.scale=t,this.container.scaleShow=Q.mul(this.container.scale,100),this.plumb.setZoom(this.container.scale))},showContainerContextMenu:function(t){var e=window.event||t;e.preventDefault(),document.querySelector(".vue-contextmenuName-node-menu").style.display="none",document.querySelector(".vue-contextmenuName-link-menu").style.display="none",this.selectContainer();var n=e.clientX,o=e.clientY;this.containerContextMenuData.axis={x:n,y:o}},showNodeContextMenu:function(t){var e=window.event||t;e.preventDefault(),document.querySelector(".vue-contextmenuName-flow-menu").style.display="none",document.querySelector(".vue-contextmenuName-link-menu").style.display="none";var n=e.clientX,o=e.clientY;this.nodeContextMenuData.axis={x:n,y:o}},flowInfo:function(){var t=this.flowData.nodeList,e=this.flowData.linkList;this.$message.info("当前流程图中有 "+t.length+" 个节点，有 "+e.length+" 条连线。")},paste:function(){var t=this,e=0;this.clipboard.forEach(function(n){var o=M()({},n);o.id=o.type+"-"+Q.getId();var i=t.computeNodePos(t.mouse.position.x+e,t.mouse.position.y+e);o.x=i.x,o.y=i.y,e+=20,t.flowData.nodeList.push(o)})},selectAll:function(){var t=this;this.flowData.nodeList.forEach(function(e){t.plumb.addToDragSelection(e.id),t.currentSelectGroup.push(e)})},saveFlow:function(){this.$emit("saveFlow")},checkAlign:function(){return!(this.currentSelectGroup.length<2)||(this.$message.error("请选择至少两个节点！"),!1)},verticaLeft:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=function(a){i=i+n[a-1].height+t.flowConfig.defaultStyle.alignSpacing.vertical;var l=e.find(function(t){return t.id===n[a].id});l.tx=o,l.ty=i,t.plumb.animate(n[a].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){l.x=l.tx,l.y=l.ty}})},l=1;l<n.length;l++)a(l)},verticalCenter:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=o,l=function(l){i=i+n[l-1].height+t.flowConfig.defaultStyle.alignSpacing.vertical,o=a+Q.div(n[0].width,2)-Q.div(n[l].width,2);var r=e.find(function(t){return t.id===n[l].id});r.tx=o,r.ty=i,t.plumb.animate(n[l].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){r.x=r.tx,r.y=r.ty}})},r=1;r<n.length;r++)l(r)},verticalRight:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=o,l=function(l){i=i+n[l-1].height+t.flowConfig.defaultStyle.alignSpacing.vertical,o=a+n[0].width-n[l].width;var r=e.find(function(t){return t.id===n[l].id});r.tx=o,r.ty=i,t.plumb.animate(n[l].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){r.x=r.tx,r.y=r.ty}})},r=1;r<n.length;r++)l(r)},levelUp:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=function(a){o=o+n[a-1].width+t.flowConfig.defaultStyle.alignSpacing.horizontal;var l=e.find(function(t){return t.id===n[a].id});l.tx=o,l.ty=i,t.plumb.animate(n[a].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){l.x=l.tx,l.y=l.ty}})},l=1;l<n.length;l++)a(l)},levelCenter:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=i,l=function(l){i=a+Q.div(n[0].height,2)-Q.div(n[l].height,2),o=o+n[l-1].width+t.flowConfig.defaultStyle.alignSpacing.horizontal;var r=e.find(function(t){return t.id===n[l].id});r.tx=o,r.ty=i,t.plumb.animate(n[l].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){r.x=r.tx,r.y=r.ty}})},r=1;r<n.length;r++)l(r)},levelDown:function(){var t=this;if(this.checkAlign())for(var e=this.flowData.nodeList,n=this.currentSelectGroup,o=n[0].x,i=n[0].y,a=i,l=function(l){i=a+n[0].height-n[l].height,o=o+n[l-1].width+t.flowConfig.defaultStyle.alignSpacing.horizontal;var r=e.find(function(t){return t.id===n[l].id});r.tx=o,r.ty=i,t.plumb.animate(n[l].id,{top:i,left:o},{duration:t.flowConfig.defaultStyle.alignDuration,complete:function(){r.x=r.tx,r.y=r.ty}})},r=1;r<n.length;r++)l(r)},addRemark:function(){this.$message.info("添加备注(待完善)...")},copyNode:function(){this.clipboard=[],this.currentSelectGroup.length>0?this.clipboard=M()([],this.currentSelectGroup):this.currentSelect.id&&this.clipboard.push(this.currentSelect)},getConnectionsByNodeId:function(t){var e=this.plumb.getConnections({source:t}),n=this.plumb.getConnections({target:t});return e.concat(n)},deleteNode:function(){var t=this,e=this.flowData.nodeList,n=this.flowData.linkList,o=[];o.push(M()({},this.currentSelect)),this.flowData.status=j,o.forEach(function(o){t.getConnectionsByNodeId(o.id).forEach(function(e){n.splice(n.findIndex(function(t){return t.sourceId===e.sourceId&&t.targetId===e.targetId}),1),t.plumb.deleteConnection(t.plumb.getConnections({source:e.sourceId,target:e.targetId})[0])});var i=e.findIndex(function(t){return t.id===o.id});e.splice(i,1)}),this.flowData.status=H,this.selectContainer()},addNewNode:function(t){var e=this.mouse.position.x,n=this.mouse.position.y,o=this.computeNodePos(e,n);e=o.x,n=o.y;var i=M()({},t);i.id=i.type+"-"+Q.getId(),i.height=50,"start"===i.type||"end"===i.type||"event"===i.type||"gateway"===i.type?(i.x=e-25,i.width=50):(i.x=e-60,i.width=120),i.y=n-25,"x-lane"===i.type?(i.height=200,i.width=500):"y-lane"===i.type&&(i.height=500,i.width=200),this.flowData.nodeList.push(i)},computeNodePos:function(t,e){var n=this.flowConfig.defaultStyle.alignGridPX[0],o=this.flowConfig.defaultStyle.alignGridPX[1];return t%n&&(t=n-t%n+t),e%o&&(e=o-e%o+e),{x:t,y:e}},containerHandler:function(){this.selectContainer()},selectContainer:function(){this.currentSelect={},this.$emit("getShortcut")},isMultiple:function(t){t(this.rectangleMultiple.flag)},updateNodePos:function(){var t=this.flowData.nodeList;this.currentSelectGroup.forEach(function(e){var n=parseInt(document.querySelector("#"+e.id).style.left),o=parseInt(document.querySelector("#"+e.id).style.top),i=t.find(function(t){return t.id===e.id});i.x=n,i.y=o})},alignForLine:function(t){var e=this;if(!(this.selectGroup.length>1)&&this.container.auxiliaryLine.controlFnTimesFlag){var n=t.el.id;this.flowData.nodeList.forEach(function(o){if(n!==o.id){var i=e.flowConfig.defaultStyle.showAuxiliaryLineDistance,a=t.pos,l=t.el.offsetHeight,r=t.el.offsetWidth,s=a[0]-o.x,c=a[1]-o.y;if(s>=-i&&s<=i||s+r>=-i&&s+r<=i){e.container.auxiliaryLine.isShowYLine=!0,e.auxiliaryLinePos.x=o.x+e.container.pos.left;var u=o.x+o.width/2;u===a[0]+r/2&&(e.auxiliaryLinePos.x=u+e.container.pos.left)}if(c>=-i&&c<=i||c+l>=-i&&c+l<=i){e.container.auxiliaryLine.isShowXLine=!0,e.auxiliaryLinePos.y=o.y+e.container.pos.top;var d=o.y+o.height/2;d===a[1]+l/2&&(e.auxiliaryLinePos.y=d+e.container.pos.left)}}}),this.container.auxiliaryLine.controlFnTimesFlag=!1,setTimeout(function(){e.container.auxiliaryLine.controlFnTimesFlag=!0},200)}},hideAlignLine:function(){this.container.auxiliaryLine.isOpen&&(this.container.auxiliaryLine.isShowXLine=!1,this.container.auxiliaryLine.isShowYLine=!1)}},watch:{select:function(t){this.currentSelect=t,""!==this.tempLinkId&&(document.querySelector("#"+this.tempLinkId)&&document.querySelector("#"+this.tempLinkId).classList.remove("link-active"),this.tempLinkId=""),"link"===this.currentSelect.type&&(this.tempLinkId=this.currentSelect.id,document.querySelector("#"+this.currentSelect.id)&&document.querySelector("#"+this.currentSelect.id).classList.add("link-active"))},currentSelect:{handler:function(t){this.$emit("update:select",t)},deep:!0},selectGroup:function(t){this.currentSelectGroup=t,this.currentSelectGroup.length<=0&&this.plumb.clearDragSelection()},currentSelectGroup:{handler:function(t){this.$emit("update:selectGroup",t)},deep:!0}}},at={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},on:{dragover:t.allowDrop,drop:t.drop}},[t.container.auxiliaryLine.isOpen&&t.container.auxiliaryLine.isShowXLine?n("div",{staticClass:"auxiliary-line-x",style:{top:t.auxiliaryLinePos.y+"px"}}):t._e(),t._v(" "),t.container.auxiliaryLine.isOpen&&t.container.auxiliaryLine.isShowYLine?n("div",{staticClass:"auxiliary-line-y",style:{left:t.auxiliaryLinePos.x+"px"}}):t._e(),t._v(" "),n("div",{staticClass:"flow-container",class:{grid:t.flowData.config.showGrid,zoomIn:"zoom-in"===t.currentTool.type,zoomOut:"zoom-out"===t.currentTool.type,canScale:t.container.scaleFlag,canDrag:t.container.dragFlag,canMultiple:t.rectangleMultiple.flag},style:t.gridStyle,attrs:{id:"flowContainer"},on:{click:function(e){return e.stopPropagation(),t.containerHandler.apply(null,arguments)},mousedown:t.mousedownHandler,mousemove:t.mousemoveHandler,mouseup:t.mouseupHandler,mousewheel:t.scaleContainer,DOMMouseScroll:t.scaleContainer,contextmenu:t.showContainerContextMenu}},[t._l(t.flowData.nodeList,function(e){return n("flow-node",{key:e.id,attrs:{node:e,flowConfig:t.flowConfig,plumb:t.plumb,select:t.currentSelect,selectGroup:t.currentSelectGroup,currentTool:t.currentTool},on:{"update:select":function(e){t.currentSelect=e},"update:selectGroup":function(e){t.currentSelectGroup=e},"update:select-group":function(e){t.currentSelectGroup=e},showNodeContextMenu:t.showNodeContextMenu,isMultiple:t.isMultiple,updateNodePos:t.updateNodePos,alignForLine:t.alignForLine,hideAlignLine:t.hideAlignLine}})}),t._v(" "),t.rectangleMultiple.flag&&t.rectangleMultiple.multipling?n("div",{staticClass:"rectangle-multiple",style:{top:t.rectangleMultiple.position.top+"px",left:t.rectangleMultiple.position.left+"px",width:t.rectangleMultiple.width+"px",height:t.rectangleMultiple.height+"px"}}):t._e()],2),t._v(" "),n("div",{staticClass:"container-scale"},[n("a-button",{attrs:{icon:"zoom-out",size:"small",type:"default"},on:{click:t.narrowContainer}}),t._v(" "),n("span",[t._v(t._s(t.container.scaleShow)+"% ")]),t._v(" "),n("a-button",{attrs:{icon:"zoom-in",size:"small",type:"default"},on:{click:t.enlargeContainer}})],1),t._v(" "),n("div",{staticClass:"mouse-position"},[t._v("\n    x: "+t._s(t.mouse.position.x)+", y: "+t._s(t.mouse.position.y)+"\n  ")]),t._v(" "),n("vue-context-menu",{attrs:{contextMenuData:t.containerContextMenuData},on:{flowInfo:t.flowInfo,paste:t.paste,selectAll:t.selectAll,saveFlow:t.saveFlow,verticaLeft:t.verticaLeft,verticalCenter:t.verticalCenter,verticalRight:t.verticalRight,levelUp:t.levelUp,levelCenter:t.levelCenter,levelDown:t.levelDown,addRemark:t.addRemark}}),t._v(" "),n("vue-context-menu",{attrs:{contextMenuData:t.nodeContextMenuData},on:{copyNode:t.copyNode,deleteNode:t.deleteNode}})],1)},staticRenderFns:[]};var lt=n("VU/8")(it,at,!1,function(t){n("QAy5")},null,null).exports,rt={props:["plumb","flowData","select"],data:function(){return{currentSelect:this.select,formItemLayout:{labelCol:{span:0},wrapperCol:{span:24}},activeKey:"flow-attr"}},methods:{nodeNameChange:function(t){this.currentSelect.nodeName=t.target.value},linkLabelChange:function(t){var e=this,n=t.target.value;this.currentSelect.label=n;var o=this.plumb.getConnections({source:this.currentSelect.sourceId,target:this.currentSelect.targetId})[0],i=o.canvas.id,a=function(t){(window.event||t).stopPropagation(),e.currentSelect=e.flowData.linkList.find(function(t){return t.id===i})};if(""!==n)o.setLabel({label:n,cssClass:"linkLabel "+i}),document.querySelector("."+i).addEventListener("click",a);else{document.querySelector("."+i).removeEventListener("click",a);var l=o.getLabelOverlay();l&&o.removeOverlay(l.id)}}},watch:{select:function(t){this.currentSelect=t,"link"===this.currentSelect.type?this.activeKey="link-attr":this.currentSelect.type?this.activeKey="node-attr":this.activeKey="flow-attr"},currentSelect:{handler:function(t){this.$emit("update:select",t)},deep:!0}}},st={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-tabs",{attrs:{size:"small",activeKey:t.activeKey}},[n("a-tab-pane",{key:"flow-attr"},[n("span",{attrs:{slot:"tab"},slot:"tab"},[n("a-icon",{attrs:{type:"cluster"}}),t._v("\n\t\t\t\t\t流程属性\n\t\t\t\t")],1),t._v(" "),n("a-form",{attrs:{layout:"vertical"}},[n("a-form-item",{attrs:{label:"流程id","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.flowData.attr.id,disabled:""}})],1)],1)],1),t._v(" "),n("a-tab-pane",{key:"node-attr"},[n("span",{attrs:{slot:"tab"},slot:"tab"},[n("a-icon",{attrs:{type:"profile"}}),t._v("\n\t\t\t\t\t节点属性\n\t\t\t\t")],1),t._v(" "),n("a-form",{attrs:{layout:"vertical"}},[n("a-form-item",{attrs:{label:"类型","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-tag",{attrs:{color:"purple"}},[t._v(t._s(t.currentSelect.type))])],1),t._v(" "),n("a-form-item",{attrs:{label:"id","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.currentSelect.id,disabled:""}})],1),t._v(" "),n("a-form-item",{attrs:{label:"名称","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{placeholder:"请输入节点名称",value:t.currentSelect.nodeName},on:{change:t.nodeNameChange}})],1)],1)],1),t._v(" "),n("a-tab-pane",{key:"link-attr"},[n("span",{attrs:{slot:"tab"},slot:"tab"},[n("a-icon",{attrs:{type:"branches"}}),t._v("\n\t\t\t\t\t连线属性\n\t\t\t\t")],1),t._v(" "),n("a-form",{attrs:{layout:"vertical"}},[n("a-form-item",{attrs:{label:"id","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.currentSelect.id,disabled:""}})],1),t._v(" "),n("a-form-item",{attrs:{label:"源节点","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.currentSelect.sourceId,disabled:""}})],1),t._v(" "),n("a-form-item",{attrs:{label:"目标节点","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.currentSelect.targetId,disabled:""}})],1),t._v(" "),n("a-form-item",{attrs:{label:"文本","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-input",{attrs:{value:t.currentSelect.label},on:{change:t.linkLabelChange}})],1)],1)],1)],1)},staticRenderFns:[]};var ct=n("VU/8")(rt,st,!1,function(t){n("3QEs")},null,null).exports,ut={props:{flowConfig:{type:Object,default:function(){return{}}}},data:function(){return{settingVisible:!1,formItemLayout:{labelCol:{span:6},wrapperCol:{span:15}},settingForm:this.$form.createForm(this),config:this.flowConfig,settingConfig:F()(z)}},methods:{setDefault:function(){this.config=tt(this.config,z),this.$ls.set("settingConfig",z),this.close(),this.$message.success("恢复默认成功")},handleSubmit:function(){this.config=tt(this.config,this.settingConfig),this.$ls.set("settingConfig",this.settingConfig),this.close(),this.$message.success("设置成功")},open:function(){this.settingVisible=!0,this.settingConfig=this.$ls.get("settingConfig")||F()(z)},close:function(){this.settingVisible=!1},formatOnceNarrow:function(t){return 100*t+"%"},formatOnceEnlarge:function(t){return 100*t+"%"}}},dt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-drawer",{attrs:{title:"设置",placement:"right",zIndex:1001,width:600,visible:t.settingVisible},on:{close:t.close}},[n("a-form",{staticStyle:{"margin-bottom":"40px"},attrs:{form:t.settingForm,layout:"horizontal"}},[n("a-divider",{attrs:{orientation:"left"}},[t._v("画布")]),t._v(" "),n("a-form-item",{attrs:{label:"缩小比例","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:.05,max:.5,step:.05,tipFormatter:t.formatOnceNarrow},model:{value:t.settingConfig.containerScale.onceNarrow,callback:function(e){t.$set(t.settingConfig.containerScale,"onceNarrow",e)},expression:"settingConfig.containerScale.onceNarrow"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"放大比例","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:.05,max:.5,step:.05,tipFormatter:t.formatOnceEnlarge},model:{value:t.settingConfig.containerScale.onceEnlarge,callback:function(e){t.$set(t.settingConfig.containerScale,"onceEnlarge",e)},expression:"settingConfig.containerScale.onceEnlarge"}})],1),t._v(" "),n("a-divider",{attrs:{orientation:"left"}},[t._v("连线")]),t._v(" "),n("a-form-item",{attrs:{label:"类型","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-select",{model:{value:t.settingConfig.cls.linkType,callback:function(e){t.$set(t.settingConfig.cls,"linkType",e)},expression:"settingConfig.cls.linkType"}},[n("a-select-option",{attrs:{value:"Bezier"}},[t._v("贝塞尔曲线")]),t._v(" "),n("a-select-option",{attrs:{value:"Straight"}},[t._v("直线")]),t._v(" "),n("a-select-option",{attrs:{value:"Flowchart"}},[t._v("流程图线")]),t._v(" "),n("a-select-option",{attrs:{value:"StateMachine"}},[t._v("状态线")])],1)],1),t._v(" "),n("a-form-item",{attrs:{label:"颜色","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("colorPicker",{model:{value:t.settingConfig.cls.linkColor,callback:function(e){t.$set(t.settingConfig.cls,"linkColor",e)},expression:"settingConfig.cls.linkColor"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"粗细","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:1,max:10},model:{value:t.settingConfig.cls.linkThickness,callback:function(e){t.$set(t.settingConfig.cls,"linkThickness",e)},expression:"settingConfig.cls.linkThickness"}})],1),t._v(" "),n("a-divider",{attrs:{orientation:"left"}},[t._v("默认样式")]),t._v(" "),n("a-form-item",{attrs:{label:"辅助线","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-switch",{attrs:{checkedChildren:"开",unCheckedChildren:"关"},model:{value:t.settingConfig.other.isOpenAuxiliaryLine,callback:function(e){t.$set(t.settingConfig.other,"isOpenAuxiliaryLine",e)},expression:"settingConfig.other.isOpenAuxiliaryLine"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"自动对齐水平间距","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:10,max:800,step:5},model:{value:t.settingConfig.other.horizontal,callback:function(e){t.$set(t.settingConfig.other,"horizontal",e)},expression:"settingConfig.other.horizontal"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"自动对齐垂直间距","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:10,max:800,step:5},model:{value:t.settingConfig.other.vertical,callback:function(e){t.$set(t.settingConfig.other,"vertical",e)},expression:"settingConfig.other.vertical"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"微移距离","label-col":t.formItemLayout.labelCol,"wrapper-col":t.formItemLayout.wrapperCol}},[n("a-slider",{attrs:{min:1},model:{value:t.settingConfig.other.movePx,callback:function(e){t.$set(t.settingConfig.other,"movePx",e)},expression:"settingConfig.other.movePx"}})],1)],1),t._v(" "),n("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[n("a-button",{style:{marginRight:"8px"},on:{click:t.setDefault}},[t._v("\n      恢复默认\n    ")]),t._v(" "),n("a-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("\n      确定\n    ")])],1)],1)},staticRenderFns:[]};var ft=n("VU/8")(ut,dt,!1,function(t){n("vdqo")},null,null).exports,pt=n("gRE1"),ht=n.n(pt),mt={data:function(){return{modalVisible:!1,columns:[{title:"功能",align:"center",key:"shortcutName",dataIndex:"shortcutName",width:"50%"},{title:"快捷键",align:"center",key:"codeName",dataIndex:"codeName",width:"50%"}],dataSource:[]}},methods:{open:function(){this.modalVisible=!0,this.dataSource=ht()(U)},close:function(){this.dataSource=[],this.modalVisible=!1},saveSetting:function(){this.close()}}},gt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("a-modal",{attrs:{title:"快捷键大全",width:"600px",visible:this.modalVisible,footer:null},on:{cancel:this.close}},[e("a-table",{attrs:{rowKey:"code",size:"small",pagination:!1,columns:this.columns,dataSource:this.dataSource}})],1)},staticRenderFns:[]};var vt=n("VU/8")(mt,gt,!1,function(t){n("GB6M")},null,null).exports,yt=n("R0ti"),wt={components:{JsonView:n.n(yt).a},props:{flowConfig:{type:Object,default:function(){return{}}}},data:function(){return{testVisible:!1,flowData:null,flowDataJson:""}},methods:{onClose:function(){this.testVisible=!1},editFlowDataJson:function(t){this.flowDataJson=t.target.value},tempSave:function(){var t=M()({},this.flowData);t.status=V,this.flowDataJson=I()(t)},onLoad:function(){this.$emit("loadFlow",this.flowDataJson),this.onClose()}}},bt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-drawer",{attrs:{title:"测试",placement:"right",width:600,visible:t.testVisible},on:{close:t.onClose}},[n("div",[t._v("当前的flowData:")]),t._v(" "),n("json-view",{attrs:{value:t.flowData,"expand-depth":3,boxed:"",copyable:""}}),t._v(" "),n("div",{staticStyle:{"margin-top":"12px"}},[t._v("暂存:")]),t._v(" "),n("a-textarea",{attrs:{autoSize:{minRows:10,maxRows:100},value:t.flowDataJson},on:{change:t.editFlowDataJson}}),t._v(" "),n("a-divider"),t._v(" "),n("a-button",{style:{marginRight:"8px"},on:{click:t.tempSave}},[t._v("暂存")]),t._v(" "),n("a-button",{attrs:{type:"primary"},on:{click:t.onLoad}},[t._v("加载(暂存中的json数据)")])],1)],1)},staticRenderFns:[]};var Ct=n("VU/8")(wt,bt,!1,function(t){n("udmJ")},null,null).exports,xt={name:"NodeList",props:{nodeList:{type:Array,default:function(){return[]}},type:{type:String,default:""}},methods:{dragNode:function(t,e){this.$emit("setDragInfo",{type:t,belongTo:e})}}},St={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-list",{attrs:{grid:{gutter:0,column:1}}},t._l(t.nodeList,function(e){return n("a-list-item",{key:e.type},[n("a-tooltip",{attrs:{title:e.nodeName,placement:"right"}},[n("div",{staticClass:"node-item",attrs:{draggable:"true"},on:{dragstart:function(n){return t.dragNode(e.type,t.type)}}},[n("a-icon",{attrs:{type:e.icon}})],1)])],1)}),1)},staticRenderFns:[]};var kt=n("VU/8")(xt,St,!1,function(t){n("eS/3")},"data-v-6157c75f",null).exports,Lt={name:"vfdp",components:{html2canvas:W.a,canvg:K.a,FlowArea:lt,FlowAttr:ct,SettingModal:ft,ShortcutModal:vt,TestModal:Ct,NodeList:kt},data:function(){return{flowConfig:F()(q),info:{version:"1.1.0",author:"前端爱码士",gitee:"https://gitee.com/zhangyeping/vue-flow-design-plus"},browserType:3,plumb:{},field:{tools:A,commonNodes:E,highNodes:$,laneNodes:O},flowData:{nodeList:[],linkList:[],attr:{id:""},config:{showGrid:!0,showGridText:"隐藏网格",showGridIcon:"eye"},status:H,remarks:[]},currentTool:{type:"drag",icon:"drag",name:"拖拽"},currentSelect:{},currentSelectGroup:[],activeShortcut:!0,linkContextMenuData:Y,flowPicture:{url:"",modalVisible:!1,closable:!1,maskClosable:!1},dragInfo:{type:"",belongTo:""}}},mounted:function(){this.dealCompatibility(),this.initJsPlumb(),this.listenShortcut(),this.initSettingConfig(),this.initFlow()},methods:{initSettingConfig:function(){this.$ls.get("settingConfig")?this.flowConfig=tt(this.flowConfig,this.$ls.get("settingConfig")):this.$ls.set("settingConfig",z)},setDragInfo:function(t){this.dragInfo=t},dealCompatibility:function(){var t,e;this.browserType=(t=navigator.userAgent,(e=t.indexOf("Opera")>-1)?1:t.indexOf("Firefox")>-1?2:t.indexOf("Chrome")>-1?3:t.indexOf("Safari")>-1?4:t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!e?(l.a.error("IE浏览器支持性较差，推荐使用Firefox或Chrome"),5):t.indexOf("Trident")>-1?(l.a.error("Edge浏览器支持性较差，推荐使用Firefox或Chrome"),6):void 0),2===this.browserType&&(U.scaleContainer={code:16,codeName:"SHIFT(chrome下为ALT)",shortcutName:"画布缩放"})},initJsPlumb:function(){var t=this;this.plumb=P.jsPlumb.getInstance(this.flowConfig.jsPlumbInsConfig),this.plumb.bind("beforeDrop",function(e){var n=e.sourceId,o=e.targetId;return n!==o&&(!t.flowData.linkList.find(function(t){return t.sourceId===n&&t.targetId===o})||(t.$message.error("同方向的两节点连线只能有一条！"),!1))}),this.plumb.bind("connection",function(e){var n=e.connection.canvas,o={},i=void 0,a=void 0;if(t.flowData.status===H||t.flowData.status===R)i="link-"+Q.getId(),a="";else if(t.flowData.status===j){var l=t.flowData.linkList[t.flowData.linkList.length-1];i=l.id,a=l.label}n.id=i,o.type="link",o.id=i,o.sourceId=e.sourceId,o.targetId=e.targetId,o.label=a,o.cls={linkType:t.flowConfig.jsPlumbInsConfig.Connector[0],linkColor:t.flowConfig.jsPlumbInsConfig.PaintStyle.stroke,linkThickness:t.flowConfig.jsPlumbInsConfig.PaintStyle.strokeWidth},document.querySelector("#"+i).addEventListener("contextmenu",function(e){t.showLinkContextMenu(e),t.currentSelect=t.flowData.linkList.find(function(t){return t.id===i})}),document.querySelector("#"+i).addEventListener("click",function(e){(window.event||e).stopPropagation(),t.currentSelect=t.flowData.linkList.find(function(t){return t.id===i})}),t.flowData.status!==j&&t.flowData.linkList.push(o)}),this.plumb.importDefaults({ConnectionsDetachable:this.flowConfig.jsPlumbConfig.conn.isDetachable})},listenShortcut:function(){var t=this;document.onkeydown=function(e){var n=window.event||e;if(t.activeShortcut){var o=n.keyCode;switch(o){case U.multiple.code:t.$refs.flowArea.rectangleMultiple.flag=!0;break;case U.dragContainer.code:t.$refs.flowArea.container.dragFlag=!0;break;case U.dragTool.code:t.selectTool("drag");break;case U.connTool.code:t.selectTool("connection");break;case U.leftMove.code:t.moveNode("left");break;case U.upMove.code:t.moveNode("up");break;case U.rightMove.code:t.moveNode("right");break;case U.downMove.code:t.moveNode("down")}if(n.ctrlKey)switch(o){case U.settingModal.code:t.saveFlow();break;case U.testModal.code:t.openTest()}}},document.onkeyup=function(e){var n=(window.event||e).keyCode;n===U.dragContainer.code?t.$refs.flowArea.container.dragFlag=!1:n===U.multiple.code&&(t.$refs.flowArea.rectangleMultiple.flag=!1)}},initFlow:function(){this.flowData.status===H?this.flowData.attr.id="flow-"+Q.getId():this.loadFlow()},loadFlow:function(t){var e=this;this.clear(),this.$nextTick(function(){var n=JSON.parse(t);e.flowData.attr=n.attr,e.flowData.config=n.config,e.flowData.status=j,e.plumb.batch(function(){n.nodeList.forEach(function(t){e.flowData.nodeList.push(t)});var t=n.linkList;e.$nextTick(function(){t.forEach(function(t){e.flowData.linkList.push(t);var n=e.plumb.connect({source:t.sourceId,target:t.targetId,anchor:e.flowConfig.jsPlumbConfig.anchor.default,connector:[t.cls.linkType,{gap:5,cornerRadius:8,alwaysRespectStubs:!0}],paintStyle:{stroke:t.cls.linkColor,strokeWidth:t.cls.linkThickness}}),o=n.canvas.id,i=function(t){(window.event||t).stopPropagation(),e.currentSelect=e.flowData.linkList.find(function(t){return t.id===o})};""!==t.label?(n.setLabel({label:t.label,cssClass:"linkLabel "+o}),document.querySelector("."+o).addEventListener("click",i)):document.querySelector("."+o)&&document.querySelector("."+o).removeEventListener("click",i)}),e.currentSelect={},e.currentSelectGroup=[],e.flowData.status=R})},!0);var o=e.computeCanvasSize();e.$refs.flowArea.container.pos={top:100-o.minY,left:100-o.minX}})},findNodeConfig:function(t,e,n){var o=null;switch(t){case"commonNodes":o=E.find(function(t){return t.type===e});break;case"highNodes":o=$.find(function(t){return t.type===e});break;case"laneNodes":o=O.find(function(t){return t.type===e})}n(o)},selectTool:function(t){var e=A.find(function(e){return e.type===t});switch(e&&(this.currentTool=e),t){case"drag":this.changeToDrag();break;case"connection":this.changeToConnection()}},changeToDrag:function(){var t=this;this.flowData.nodeList.forEach(function(e){t.plumb.toggleDraggable(e.id)||t.plumb.toggleDraggable(e.id),"x-lane"!==e.type&&"y-lane"!==e.type&&(t.plumb.unmakeSource(e.id),t.plumb.unmakeTarget(e.id))})},changeToConnection:function(){var t=this;this.flowData.nodeList.forEach(function(e){t.plumb.toggleDraggable(e.id)&&t.plumb.toggleDraggable(e.id),"x-lane"!==e.type&&"y-lane"!==e.type&&(t.plumb.makeSource(e.id,t.flowConfig.jsPlumbConfig.makeSourceConfig),t.plumb.makeTarget(e.id,t.flowConfig.jsPlumbConfig.makeTargetConfig))}),this.currentSelect={},this.currentSelectGroup=[]},changeToZoomIn:function(){console.log("切换到放大工具")},changeToZoomOut:function(){console.log("切换到缩小工具")},checkFlow:function(){return!(this.flowData.nodeList.length<=0)||(this.$message.error("流程图中无任何节点！"),!1)},saveFlow:function(){var t=M()({},this.flowData);if(this.checkFlow()){t.status=V;var e=I()(t);return this.$message.success("保存流程成功！请查看控制台。"),e}},exportFlowPicture:function(){var t=this;if(this.checkFlow()){var e=this.$refs.flowArea.$el.children[0],n=[];e.querySelectorAll('svg[id^="link-"]').forEach(function(t){var o=document.createElement("canvas"),i="linkCanvas-"+Q.getId();o.id=i,n.push(i);var a=t.outerHTML.trim();K()(o,a),t.style.position&&(o.style.position+=t.style.position,o.style.left+=t.style.left,o.style.top+=t.style.top),e.appendChild(o)});var o=this.computeCanvasSize(),i=this.flowConfig.defaultStyle.photoBlankDistance,a=Q.div(i,2);W()(e,{width:o.width+i,height:o.height+i,scrollX:-o.minX+a,scrollY:-o.minY+a,logging:!1,onclone:function(){n.forEach(function(t){var e=document.querySelector("#"+t);e.parentNode.removeChild(e)})}}).then(function(e){var n=e.toDataURL("image/png");t.flowPicture.url=n,t.flowPicture.modalVisible=!0})}},downLoadFlowPicture:function(){var t=document.createElement("a"),e="alink-"+Q.getId();t.id=e,t.href=this.flowPicture.url,t.download="流程设计图_"+this.flowData.attr.id+".png",t.click()},cancelDownLoadFlowPicture:function(){this.flowPicture.url="",this.flowPicture.modalVisible=!1},computeCanvasSize:function(){var t=M()([],this.flowData.nodeList),e=t[0].x,n=t[0].y,o=t[0].x+t[0].width,i=t[0].y+t[0].height;return t.forEach(function(t){e=Math.min(e,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x+t.width),i=Math.max(i,t.y+t.height)}),{width:o-e,height:i-n,minX:e,minY:n,maxX:o,maxY:i}},clear:function(){var t=this;this.flowData.nodeList.forEach(function(e){t.plumb.remove(e.id)}),this.currentSelect={},this.currentSelectGroup=[],this.flowData.nodeList=[],this.flowData.linkList=[],this.flowData.remarks=[]},toggleShowGrid:function(){this.flowData.config.showGrid?(this.flowData.config.showGrid=!1,this.flowData.config.showGridText="显示网格",this.flowData.config.showGridIcon="eye-invisible"):(this.flowData.config.showGrid=!0,this.flowData.config.showGridText="隐藏网格",this.flowData.config.showGridIcon="eye")},setting:function(){this.$refs.settingModal.open()},shortcutHelper:function(){this.$refs.shortcutModal.open()},goGit:function(){window.open(this.info.gitee)},showLinkContextMenu:function(t){var e=window.event||t;e.preventDefault(),e.stopPropagation(),document.querySelector(".vue-contextmenuName-flow-menu").style.display="none",document.querySelector(".vue-contextmenuName-node-menu").style.display="none";var n=e.clientX,o=e.clientY;this.linkContextMenuData.axis={x:n,y:o}},deleteLink:function(){var t=this.currentSelect.sourceId,e=this.currentSelect.targetId;this.plumb.deleteConnection(this.plumb.getConnections({source:t,target:e})[0]);var n=this.flowData.linkList;n.splice(n.findIndex(function(n){return n.sourceId===t&&n.targetId===e}),1),this.currentSelect={}},loseShortcut:function(){this.activeShortcut=!1},getShortcut:function(){this.activeShortcut=!0},openTest:function(){var t=M()({},this.flowData);this.$refs.testModal.flowData=t,this.$refs.testModal.testVisible=!0},moveNode:function(t){var e=this.flowConfig.defaultStyle.movePx,n=!0;switch(t){case"left":e=-e;break;case"up":e=-e,n=!1;break;case"right":break;case"down":n=!1}this.currentSelectGroup.length>0?(this.currentSelectGroup.forEach(function(t){n?t.x+=e:t.y+=e}),this.plumb.repaintEverything()):this.currentSelect.id&&(n?this.currentSelect.x+=e:this.currentSelect.y+=e,this.plumb.repaintEverything())}}},Nt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{height:"100%"}},[n("a-layout",{staticClass:"container"},[n("a-layout-sider",{staticClass:"select-area",attrs:{width:"44",theme:"light"}},[n("a-row",[n("div",{staticClass:"tab"},[t._v("基础")]),t._v(" "),n("node-list",{attrs:{nodeList:t.field.commonNodes,type:"commonNodes"},on:{setDragInfo:t.setDragInfo}})],1),t._v(" "),n("a-row",[n("div",{staticClass:"tab"},[t._v("高级")]),t._v(" "),n("node-list",{attrs:{nodeList:t.field.highNodes,type:"highNodes"},on:{setDragInfo:t.setDragInfo}})],1),t._v(" "),n("a-row",[n("div",{staticClass:"tab"},[t._v("泳道")]),t._v(" "),n("node-list",{attrs:{nodeList:t.field.laneNodes,type:"laneNodes"},on:{setDragInfo:t.setDragInfo}})],1)],1),t._v(" "),n("a-layout",[n("a-layout-header",{staticClass:"header-option"},[n("div",{staticClass:"header-option__tools"},t._l(t.field.tools,function(e){return n("span",{key:e.type},[n("a-tooltip",{attrs:{title:e.name,placement:"right"}},[n("a-button",{attrs:{icon:e.icon,size:"small",type:t.currentTool.type===e.type?"primary":"default"},on:{click:function(n){return t.selectTool(e.type)}}})],1)],1)}),0),t._v(" "),n("div",{staticClass:"header-option__buttons"},[n("a-tooltip",{attrs:{title:"生成流程图片",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"picture"},on:{click:t.exportFlowPicture}})],1),t._v(" "),n("a-popconfirm",{attrs:{title:"确认要重新绘制吗？",placement:"bottom",okText:"确认",cancelText:"取消"},on:{confirm:t.clear}},[n("a-tooltip",{attrs:{title:"重新绘制",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"delete"}})],1)],1),t._v(" "),n("a-tooltip",{attrs:{title:t.flowData.config.showGridText,placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:t.flowData.config.showGridIcon},on:{click:t.toggleShowGrid}})],1),t._v(" "),n("a-tooltip",{attrs:{title:"设置",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"setting"},on:{click:t.setting}})],1),t._v(" "),n("a-tooltip",{attrs:{title:"测试",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"tool"},on:{click:t.openTest}})],1),t._v(" "),n("a-tooltip",{attrs:{title:"快捷键大全",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"book"},on:{click:t.shortcutHelper}})],1),t._v(" "),n("a-tooltip",{attrs:{title:"GIT地址",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"github"},on:{click:t.goGit}})],1),t._v(" "),n("a-tooltip",{attrs:{title:"保存流程",placement:"bottom"}},[n("a-button",{staticClass:"header-option-button",attrs:{size:"small",icon:"save"},on:{click:t.saveFlow}})],1)],1)]),t._v(" "),n("a-layout-content",{staticClass:"content"},[n("flow-area",{ref:"flowArea",attrs:{dragInfo:t.dragInfo,browserType:t.browserType,flowData:t.flowData,flowConfig:t.flowConfig,select:t.currentSelect,selectGroup:t.currentSelectGroup,plumb:t.plumb,currentTool:t.currentTool},on:{"update:select":function(e){t.currentSelect=e},"update:selectGroup":function(e){t.currentSelectGroup=e},"update:select-group":function(e){t.currentSelectGroup=e},findNodeConfig:t.findNodeConfig,selectTool:t.selectTool,getShortcut:t.getShortcut,saveFlow:t.saveFlow}}),t._v(" "),n("vue-context-menu",{attrs:{contextMenuData:t.linkContextMenuData},on:{deleteLink:t.deleteLink}})],1),t._v(" "),n("a-layout-footer",{staticClass:"foot"},[n("span",[t._v("VFDP "+t._s(t.info.version)+", Powered by "+t._s(t.info.author))]),t._v(" "),n("span",{staticStyle:{"margin-left":"10px"}},[n("a-badge",{attrs:{dot:""}},[n("a-icon",{attrs:{type:"notification"}})],1),t._v(" "),n("a",{attrs:{href:"https://gitee.com/zhangyeping/vue3-flow-design",target:"_blank"}},[t._v("Vue3版本开源，尝鲜体验")])],1)])],1),t._v(" "),n("a-layout-sider",{staticClass:"attr-area",attrs:{width:"250",theme:"light"},on:{mousedown:function(e){return e.stopPropagation(),t.loseShortcut.apply(null,arguments)}}},[n("flow-attr",{attrs:{plumb:t.plumb,flowData:t.flowData,select:t.currentSelect},on:{"update:select":function(e){t.currentSelect=e}}})],1)],1),t._v(" "),n("a-modal",{attrs:{title:"流程设计图_"+t.flowData.attr.id+".png",centered:"",width:"90%",closable:t.flowPicture.closable,maskClosable:t.flowPicture.maskClosable,visible:t.flowPicture.modalVisible,okText:"下载到本地",cancelText:"取消"},on:{ok:t.downLoadFlowPicture,cancel:t.cancelDownLoadFlowPicture}},[n("img",{staticStyle:{width:"100%"},attrs:{src:t.flowPicture.url}})]),t._v(" "),n("setting-modal",{ref:"settingModal",attrs:{flowConfig:t.flowConfig}}),t._v(" "),n("shortcut-modal",{ref:"shortcutModal"}),t._v(" "),n("test-modal",{ref:"testModal",attrs:{flowConfig:t.flowConfig},on:{loadFlow:t.loadFlow}})],1)},staticRenderFns:[]};var Dt=n("VU/8")(Lt,Nt,!1,function(t){n("UJAi")},null,null).exports;o.default.use(D.a);var _t=new D.a({routes:[{path:"/",name:"FlowDesigner",component:Dt}]}),It=n("d64e"),Tt=n.n(It),Mt=n("uDiQ"),Pt=n.n(Mt),Gt=n("l2HY");o.default.config.productionTip=!1,o.default.use(Tt.a),o.default.use(Pt.a),o.default.use(Gt.a,{namespace:"flow__",name:"ls",storage:"local"}),new o.default({el:"#app",router:_t,components:{App:a},template:"<App/>"})},QAy5:function(t,e){},UHlt:function(t,e){},UJAi:function(t,e){},VliT:function(t,e){},ZUWK:function(t,e){},ZeJt:function(t,e){},ZgGj:function(t,e){},"eS/3":function(t,e){},gMUU:function(t,e){},"hZ/y":function(t,e){},htXu:function(t,e){},iBfo:function(t,e){},iEcd:function(t,e){},jsUr:function(t,e){},kn35:function(t,e){},nkBS:function(t,e){},pFwy:function(t,e){},rrf1:function(t,e){},udmJ:function(t,e){},vZar:function(t,e){},vdqo:function(t,e){},vnFo:function(t,e){},zb2R:function(t,e){}},["NHnr"]);